<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>replit</title>
        <link href="style.css" rel="stylesheet" type="text/css" />
        <script src="https://www.unpkg.com/lottie-web@5.12.0/build/player/lottie_worker.min.js"></script>
        <script src="./dist/dotlottie-player.js"></script>
        <script src="https://unpkg.com/@yaireo/knobs@latest"></script>
    </head>

    <body>
        <h1>Lottie Expressions Exploit Testing</h1>
        <div>A ‚ùå on any of the tests below means vulnerable / exploitable</div>
        <div id="container"></div>

        <table>
            <tr>
                <td>Document</td>
                <td id="resultDoc">‚úÖ</td>
            </tr>
            <tr>
                <td>Window</td>
                <td id="resultWindow">‚úÖ</td>
                <td id="dumpWindow"></td>
            </tr>
            <tr>
                <td>Local Storage</td>
                <td id="resultStorage">‚úÖ</td>
            </tr>
        </table>

        <div style="height: 100vh">
            <!-- <dotlottie-player
                activeStateId="Toggle animation"
                src="https://lottie.host/beb42cbc-ae6f-4d6a-b024-4cd58d8a9edb/NnuvYqzCWw.lottie"
                id="dotlottie-player"
                controls
                style="width: 500px; height: 500px"
            ></dotlottie-player> -->
            <dotlottie-player
                worker
                src="./xss-animation.json"
                id="dotlottie-player"
                controls
                autoplay
                loop
                style="width: 500px; height: 500px"
            ></dotlottie-player>
        </div>

        <div id="container" style="height: 100vh"></div>

        <script>
            function xssCallback(doc, win, storage) {
                if (typeof doc !== 'undefined') {
                    document.getElementById('resultDoc').innerText = '‚ùå';
                }

                if (typeof win !== 'undefined') {
                    document.getElementById('resultWindow').innerText = '‚ùå';
                }

                if (typeof storage !== 'undefined') {
                    document.getElementById('resultStorage').innerText = '‚ùå';
                }

                console.log({
                    doc,
                    win,
                    storage,
                });
            }

            const player = document.getElementById('dotlottie-player');

            player.addEventListener(
                'ready',
                () => {
                    const getStates = () => {
                        const states = [
                            {
                                label: 'Default state',
                                render: `
              <button type='button' class='' id='Exploding pigeon üí•'>Default</button>
            `,
                                script(knobs, name) {
                                    knobs.getKnobElm(name).addEventListener('click', (e) => {
                                        const stateName = e.target.id;
                                        if (e.target.tagName == 'BUTTON') player.enterInteractiveMode(stateName);
                                    });
                                },
                            },
                        ];

                        player.getManifest().states?.forEach((state) => {
                            states.push({
                                label: state,
                                render: `
              <button type='button' class='' id='${state}'>${state}</button>
            `,
                                script(knobs, name) {
                                    knobs.getKnobElm(name).addEventListener('click', (e) => {
                                        const stateName = e.target.id;
                                        if (e.target.tagName == 'BUTTON') player.enterInteractiveMode(stateName);
                                    });
                                },
                                defaultValue: 'Exploding pigeon üí•',
                            });
                        });

                        console.log('states: ');
                        console.log(states);

                        return states;
                    };

                    var settings = {
                        visible: 1,
                        knobs: getStates(),
                    };

                    const penKobs = new Knobs(settings);

                    penKobs.render();
                },
                { once: true },
            );
        </script>
    </body>
</html>
